<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Blog Newsletter Popup Test</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            line-height: 1.6;\n            margin: 0;\n            padding: 40px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            color: #333;\n        }\n        \n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n        }\n        \n        h1 {\n            color: #667eea;\n            text-align: center;\n            margin-bottom: 30px;\n        }\n        \n        .test-section {\n            background: #f8f9fa;\n            padding: 20px;\n            border-radius: 8px;\n            margin: 20px 0;\n            border-left: 4px solid #667eea;\n        }\n        \n        .test-section h3 {\n            margin-top: 0;\n            color: #495057;\n        }\n        \n        .btn {\n            background: #667eea;\n            color: white;\n            border: none;\n            padding: 12px 24px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            margin: 10px 10px 10px 0;\n            transition: background 0.2s ease;\n        }\n        \n        .btn:hover {\n            background: #5a6fd8;\n        }\n        \n        .btn-secondary {\n            background: #6c757d;\n        }\n        \n        .btn-secondary:hover {\n            background: #5a6268;\n        }\n        \n        .status {\n            padding: 10px;\n            border-radius: 6px;\n            margin: 10px 0;\n            font-weight: 500;\n        }\n        \n        .status.success {\n            background: #d4edda;\n            color: #155724;\n            border: 1px solid #c3e6cb;\n        }\n        \n        .status.error {\n            background: #f8d7da;\n            color: #721c24;\n            border: 1px solid #f5c6cb;\n        }\n        \n        .status.info {\n            background: #d1ecf1;\n            color: #0c5460;\n            border: 1px solid #bee5eb;\n        }\n        \n        .popup-controls {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin: 20px 0;\n        }\n        \n        .control-group {\n            background: white;\n            padding: 15px;\n            border-radius: 6px;\n            border: 1px solid #dee2e6;\n        }\n        \n        .control-group label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: 500;\n            color: #495057;\n        }\n        \n        .control-group input,\n        .control-group select {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ced4da;\n            border-radius: 4px;\n            font-size: 14px;\n        }\n        \n        .blog-content {\n            margin: 40px 0;\n            line-height: 1.8;\n        }\n        \n        .blog-content h2 {\n            color: #495057;\n            margin-top: 30px;\n        }\n        \n        .blog-content p {\n            margin-bottom: 15px;\n            color: #6c757d;\n        }\n        \n        .api-status {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 10px 15px;\n            border-radius: 6px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 1000;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>üìñ Blog Newsletter Popup Test</h1>\n        \n        <div id=\"api-status\" class=\"api-status\">Checking API...</div>\n        \n        <div class=\"test-section\">\n            <h3>üß™ Test Blog Newsletter Popup</h3>\n            <p>This page tests the blog newsletter popup functionality. The popup should appear automatically based on your settings, or you can trigger it manually using the controls below.</p>\n            \n            <div class=\"popup-controls\">\n                <div class=\"control-group\">\n                    <label>Manual Controls</label>\n                    <button class=\"btn\" onclick=\"showBlogPopupManually()\">Show Blog Popup</button>\n                    <button class=\"btn btn-secondary\" onclick=\"clearBlogPopupStorage()\">Clear Storage</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Test Different Delays</label>\n                    <button class=\"btn\" onclick=\"testBlogPopupDelay(1000)\">1 Second</button>\n                    <button class=\"btn\" onclick=\"testBlogPopupDelay(3000)\">3 Seconds</button>\n                    <button class=\"btn\" onclick=\"testBlogPopupDelay(5000)\">5 Seconds</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <label>Frequency Testing</label>\n                    <button class=\"btn\" onclick=\"testFrequency('always')\">Always Show</button>\n                    <button class=\"btn\" onclick=\"testFrequency('once_per_session')\">Once Per Session</button>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h3>üìä Current Settings</h3>\n            <div id=\"current-settings\">Loading settings...</div>\n        </div>\n        \n        <div class=\"test-section\">\n            <h3>üîÑ Test Results</h3>\n            <div id=\"test-results\">\n                <div class=\"status info\">No tests run yet. Use the controls above to test the blog popup.</div>\n            </div>\n        </div>\n        \n        <div class=\"blog-content\">\n            <h2>Sample Blog Content</h2>\n            <p>This is sample blog content to simulate a real blog page. The blog newsletter popup should appear while users are reading content like this.</p>\n            \n            <h2>Why Subscribe to Our Blog?</h2>\n            <p>Our blog covers the latest trends in e-commerce, marketing strategies, and business growth tips. By subscribing, you'll get:</p>\n            <ul>\n                <li>Weekly insights and tips</li>\n                <li>Exclusive content and resources</li>\n                <li>Early access to new features</li>\n                <li>Industry news and updates</li>\n            </ul>\n            \n            <h2>Recent Blog Posts</h2>\n            <p>Here are some of our recent popular blog posts:</p>\n            <ul>\n                <li>\"10 E-commerce Trends for 2024\"</li>\n                <li>\"How to Increase Your Conversion Rate\"</li>\n                <li>\"Email Marketing Best Practices\"</li>\n                <li>\"Social Media Strategy for Online Stores\"</li>\n            </ul>\n            \n            <p>The blog newsletter popup is designed to capture interested readers who are engaged with your content, making it more likely they'll subscribe to receive more valuable insights.</p>\n        </div>\n    </div>\n    \n    <!-- Load Blog Popup Handler -->\n    <script>\n        // Mock Shopify object for testing\n        window.Shopify = {\n            shop: 'test-store.myshopify.com'\n        };\n        \n        // Test functions\n        let testResults = [];\n        \n        function addTestResult(message, type = 'info') {\n            testResults.push({ message, type, timestamp: new Date().toLocaleTimeString() });\n            updateTestResults();\n        }\n        \n        function updateTestResults() {\n            const resultsDiv = document.getElementById('test-results');\n            if (testResults.length === 0) {\n                resultsDiv.innerHTML = '<div class=\"status info\">No tests run yet. Use the controls above to test the blog popup.</div>';\n                return;\n            }\n            \n            resultsDiv.innerHTML = testResults.map(result => \n                `<div class=\"status ${result.type}\">[${result.timestamp}] ${result.message}</div>`\n            ).join('');\n        }\n        \n        function showBlogPopupManually() {\n            if (window.blogPopupHandler) {\n                // Reset popup shown flag\n                window.blogPopupHandler.popupShown = false;\n                window.blogPopupHandler.showPopup();\n                addTestResult('‚úÖ Blog popup triggered manually', 'success');\n            } else {\n                addTestResult('‚ùå Blog popup handler not loaded', 'error');\n            }\n        }\n        \n        function clearBlogPopupStorage() {\n            sessionStorage.removeItem('blog_popup_shown');\n            localStorage.removeItem('blog_popup_last_shown');\n            addTestResult('üóëÔ∏è Blog popup storage cleared', 'info');\n        }\n        \n        function testBlogPopupDelay(delay) {\n            if (window.blogPopupHandler) {\n                // Override settings for test\n                window.blogPopupHandler.settings.delay = delay;\n                window.blogPopupHandler.popupShown = false;\n                clearBlogPopupStorage();\n                \n                addTestResult(`‚è±Ô∏è Testing blog popup with ${delay}ms delay...`, 'info');\n                \n                setTimeout(() => {\n                    window.blogPopupHandler.showPopup();\n                    addTestResult(`‚úÖ Blog popup shown after ${delay}ms delay`, 'success');\n                }, delay);\n            } else {\n                addTestResult('‚ùå Blog popup handler not loaded', 'error');\n            }\n        }\n        \n        function testFrequency(frequency) {\n            if (window.blogPopupHandler) {\n                window.blogPopupHandler.settings.frequency = frequency;\n                clearBlogPopupStorage();\n                \n                const shouldShow = window.blogPopupHandler.checkDisplayFrequency();\n                addTestResult(`üîÑ Frequency test (${frequency}): ${shouldShow ? 'Should show' : 'Should not show'}`, shouldShow ? 'success' : 'info');\n                \n                if (shouldShow) {\n                    window.blogPopupHandler.popupShown = false;\n                    window.blogPopupHandler.showPopup();\n                }\n            } else {\n                addTestResult('‚ùå Blog popup handler not loaded', 'error');\n            }\n        }\n        \n        async function loadCurrentSettings() {\n            try {\n                const response = await fetch('https://web-production-18602.up.railway.app/api/blog-popup/test-store.myshopify.com', {\n                    headers: {\n                        'Accept': 'application/json',\n                        'ngrok-skip-browser-warning': 'true'\n                    }\n                });\n                \n                const data = await response.json();\n                \n                if (data.success && data.blogPopupSettings) {\n                    const settings = data.blogPopupSettings;\n                    document.getElementById('current-settings').innerHTML = `\n                        <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;\">\n                            <div><strong>Enabled:</strong> ${settings.enabled ? '‚úÖ Yes' : '‚ùå No'}</div>\n                            <div><strong>Title:</strong> ${settings.title}</div>\n                            <div><strong>Delay:</strong> ${settings.delay}ms</div>\n                            <div><strong>Frequency:</strong> ${settings.frequency}</div>\n                            <div><strong>Position:</strong> ${settings.position}</div>\n                            <div><strong>Background:</strong> <span style=\"display: inline-block; width: 20px; height: 20px; background: ${settings.backgroundColor}; border-radius: 3px; vertical-align: middle;\"></span> ${settings.backgroundColor}</div>\n                        </div>\n                        <div style=\"margin-top: 10px;\"><strong>Subtitle:</strong> ${settings.subtitle}</div>\n                    `;\n                    addTestResult('‚úÖ Blog popup settings loaded successfully', 'success');\n                } else {\n                    document.getElementById('current-settings').innerHTML = '<div class=\"status error\">Failed to load settings</div>';\n                    addTestResult('‚ùå Failed to load blog popup settings', 'error');\n                }\n            } catch (error) {\n                document.getElementById('current-settings').innerHTML = '<div class=\"status error\">Error loading settings: ' + error.message + '</div>';\n                addTestResult('‚ùå Error loading settings: ' + error.message, 'error');\n            }\n        }\n        \n        async function checkAPIStatus() {\n            const statusDiv = document.getElementById('api-status');\n            try {\n                const response = await fetch('https://web-production-18602.up.railway.app/health', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    statusDiv.textContent = '‚úÖ API Connected';\n                    statusDiv.className = 'api-status status success';\n                } else {\n                    statusDiv.textContent = '‚ö†Ô∏è API Issues';\n                    statusDiv.className = 'api-status status error';\n                }\n            } catch (error) {\n                statusDiv.textContent = '‚ùå API Offline';\n                statusDiv.className = 'api-status status error';\n            }\n        }\n        \n        // Initialize page\n        document.addEventListener('DOMContentLoaded', function() {\n            checkAPIStatus();\n            loadCurrentSettings();\n            \n            // Add event listener for blog popup handler initialization\n            const checkHandler = setInterval(() => {\n                if (window.blogPopupHandler) {\n                    addTestResult('‚úÖ Blog popup handler initialized', 'success');\n                    clearInterval(checkHandler);\n                }\n            }, 500);\n            \n            // Timeout after 10 seconds\n            setTimeout(() => {\n                if (!window.blogPopupHandler) {\n                    addTestResult('‚ö†Ô∏è Blog popup handler not loaded after 10 seconds', 'error');\n                    clearInterval(checkHandler);\n                }\n            }, 10000);\n        });\n    </script>\n    \n    <!-- Load the actual blog popup handler -->\n    <script src=\"/festival-newsletter-popup/extensions/newsletter-popup/assets/blog-popup-handler.js\"></script>\n</body>\n</html>"