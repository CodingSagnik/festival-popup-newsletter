<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Dual Popup System Test - Festival + Blog Newsletter</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            line-height: 1.6;\n            margin: 0;\n            padding: 40px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            min-height: 100vh;\n            color: #333;\n        }\n        \n        .container {\n            max-width: 1000px;\n            margin: 0 auto;\n            background: white;\n            padding: 40px;\n            border-radius: 12px;\n            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n        }\n        \n        h1 {\n            color: #667eea;\n            text-align: center;\n            margin-bottom: 30px;\n        }\n        \n        .popup-comparison {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 30px;\n            margin: 30px 0;\n        }\n        \n        .popup-section {\n            background: #f8f9fa;\n            padding: 25px;\n            border-radius: 12px;\n            border-left: 4px solid #667eea;\n        }\n        \n        .popup-section.blog {\n            border-left-color: #28a745;\n        }\n        \n        .popup-section h3 {\n            margin-top: 0;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .btn {\n            background: #667eea;\n            color: white;\n            border: none;\n            padding: 12px 20px;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n            margin: 8px 8px 8px 0;\n            transition: all 0.2s ease;\n            display: inline-block;\n            text-decoration: none;\n        }\n        \n        .btn:hover {\n            background: #5a6fd8;\n            transform: translateY(-1px);\n        }\n        \n        .btn-blog {\n            background: #28a745;\n        }\n        \n        .btn-blog:hover {\n            background: #218838;\n        }\n        \n        .btn-secondary {\n            background: #6c757d;\n        }\n        \n        .btn-secondary:hover {\n            background: #5a6268;\n        }\n        \n        .btn-danger {\n            background: #dc3545;\n        }\n        \n        .btn-danger:hover {\n            background: #c82333;\n        }\n        \n        .status {\n            padding: 12px;\n            border-radius: 6px;\n            margin: 10px 0;\n            font-weight: 500;\n            font-size: 14px;\n        }\n        \n        .status.success {\n            background: #d4edda;\n            color: #155724;\n            border: 1px solid #c3e6cb;\n        }\n        \n        .status.error {\n            background: #f8d7da;\n            color: #721c24;\n            border: 1px solid #f5c6cb;\n        }\n        \n        .status.info {\n            background: #d1ecf1;\n            color: #0c5460;\n            border: 1px solid #bee5eb;\n        }\n        \n        .status.warning {\n            background: #fff3cd;\n            color: #856404;\n            border: 1px solid #ffeaa7;\n        }\n        \n        .api-status {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            padding: 10px 15px;\n            border-radius: 6px;\n            font-size: 14px;\n            font-weight: 500;\n            z-index: 1000;\n        }\n        \n        .test-controls {\n            background: #e9ecef;\n            padding: 20px;\n            border-radius: 8px;\n            margin: 20px 0;\n        }\n        \n        .control-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n            gap: 15px;\n            margin-top: 15px;\n        }\n        \n        .control-group {\n            background: white;\n            padding: 15px;\n            border-radius: 6px;\n            border: 1px solid #dee2e6;\n        }\n        \n        .control-group h4 {\n            margin: 0 0 10px 0;\n            color: #495057;\n            font-size: 14px;\n            font-weight: 600;\n        }\n        \n        .settings-display {\n            background: #f8f9fa;\n            padding: 15px;\n            border-radius: 6px;\n            margin: 10px 0;\n            font-size: 13px;\n            border: 1px solid #e9ecef;\n        }\n        \n        .settings-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 10px;\n        }\n        \n        .setting-item {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 5px 0;\n            border-bottom: 1px solid #e9ecef;\n        }\n        \n        .setting-item:last-child {\n            border-bottom: none;\n        }\n        \n        .setting-label {\n            font-weight: 500;\n            color: #495057;\n        }\n        \n        .setting-value {\n            color: #6c757d;\n            font-family: monospace;\n        }\n        \n        .color-swatch {\n            display: inline-block;\n            width: 16px;\n            height: 16px;\n            border-radius: 3px;\n            vertical-align: middle;\n            margin-right: 5px;\n            border: 1px solid #dee2e6;\n        }\n        \n        .test-results {\n            max-height: 300px;\n            overflow-y: auto;\n            border: 1px solid #dee2e6;\n            border-radius: 6px;\n            padding: 15px;\n            background: #f8f9fa;\n        }\n        \n        .result-item {\n            padding: 8px 0;\n            border-bottom: 1px solid #e9ecef;\n            font-size: 13px;\n        }\n        \n        .result-item:last-child {\n            border-bottom: none;\n        }\n        \n        .timestamp {\n            color: #6c757d;\n            font-size: 11px;\n        }\n        \n        @media (max-width: 768px) {\n            .popup-comparison {\n                grid-template-columns: 1fr;\n            }\n            \n            .container {\n                padding: 20px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>🎪📖 Dual Popup System Test</h1>\n        \n        <div id=\"api-status\" class=\"api-status\">Checking API...</div>\n        \n        <div class=\"status info\">\n            <strong>🧪 Test Environment:</strong> This page demonstrates both the Festival Popup and Blog Newsletter Popup working together. Each popup has different triggers, designs, and subscription types.\n        </div>\n        \n        <div class=\"popup-comparison\">\n            <div class=\"popup-section\">\n                <h3>🎪 Festival Popup</h3>\n                <p>Promotes seasonal offers and festival campaigns. Subscribers get festival notifications and special offers.</p>\n                \n                <div class=\"control-group\">\n                    <h4>Festival Popup Controls</h4>\n                    <button class=\"btn\" onclick=\"showFestivalPopup()\">Show Festival Popup</button>\n                    <button class=\"btn btn-secondary\" onclick=\"clearFestivalStorage()\">Clear Festival Storage</button>\n                    <button class=\"btn btn-danger\" onclick=\"testFestivalError()\">Test Error Handling</button>\n                </div>\n                \n                <div id=\"festival-settings\" class=\"settings-display\">\n                    <strong>Festival Settings:</strong> Loading...\n                </div>\n            </div>\n            \n            <div class=\"popup-section blog\">\n                <h3>📖 Blog Newsletter Popup</h3>\n                <p>Promotes blog content and updates. Subscribers get blog notifications and educational content.</p>\n                \n                <div class=\"control-group\">\n                    <h4>Blog Popup Controls</h4>\n                    <button class=\"btn btn-blog\" onclick=\"showBlogPopup()\">Show Blog Popup</button>\n                    <button class=\"btn btn-secondary\" onclick=\"clearBlogStorage()\">Clear Blog Storage</button>\n                    <button class=\"btn btn-danger\" onclick=\"testBlogError()\">Test Error Handling</button>\n                </div>\n                \n                <div id=\"blog-settings\" class=\"settings-display\">\n                    <strong>Blog Settings:</strong> Loading...\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"test-controls\">\n            <h3>🎮 Advanced Test Controls</h3>\n            \n            <div class=\"control-grid\">\n                <div class=\"control-group\">\n                    <h4>Timing Tests</h4>\n                    <button class=\"btn\" onclick=\"testSequentialPopups()\">Show Both (Sequential)</button>\n                    <button class=\"btn\" onclick=\"testSimultaneousPopups()\">Show Both (Simultaneous)</button>\n                    <button class=\"btn btn-secondary\" onclick=\"testDelayedPopups()\">Test with Delays</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <h4>Frequency Tests</h4>\n                    <button class=\"btn\" onclick=\"testFrequencySettings('always')\">Test Always Show</button>\n                    <button class=\"btn\" onclick=\"testFrequencySettings('once_per_session')\">Test Once Per Session</button>\n                    <button class=\"btn\" onclick=\"testFrequencySettings('once_per_day')\">Test Once Per Day</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <h4>Storage Management</h4>\n                    <button class=\"btn btn-secondary\" onclick=\"clearAllStorage()\">Clear All Storage</button>\n                    <button class=\"btn btn-secondary\" onclick=\"showStorageStatus()\">Show Storage Status</button>\n                    <button class=\"btn btn-secondary\" onclick=\"simulateReturningUser()\">Simulate Returning User</button>\n                </div>\n                \n                <div class=\"control-group\">\n                    <h4>API Tests</h4>\n                    <button class=\"btn\" onclick=\"testFestivalAPI()\">Test Festival API</button>\n                    <button class=\"btn btn-blog\" onclick=\"testBlogAPI()\">Test Blog API</button>\n                    <button class=\"btn btn-secondary\" onclick=\"testSubscriptionAPI()\">Test Subscription API</button>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"test-controls\">\n            <h3>📊 Test Results</h3>\n            <div id=\"test-results\" class=\"test-results\">\n                <div class=\"status info\">No tests run yet. Use the controls above to test the popup system.</div>\n            </div>\n            <button class=\"btn btn-secondary\" onclick=\"clearTestResults()\">Clear Results</button>\n            <button class=\"btn btn-secondary\" onclick=\"exportTestResults()\">Export Results</button>\n        </div>\n        \n        <div class=\"test-controls\">\n            <h3>📈 System Status</h3>\n            <div id=\"system-status\">\n                <div class=\"status info\">Initializing system status...</div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        // Mock Shopify object for testing\n        window.Shopify = {\n            shop: 'test-store.myshopify.com'\n        };\n        \n        // Test results management\n        let testResults = [];\n        \n        function addTestResult(message, type = 'info') {\n            const timestamp = new Date().toLocaleTimeString();\n            testResults.push({ message, type, timestamp });\n            updateTestResults();\n        }\n        \n        function updateTestResults() {\n            const resultsDiv = document.getElementById('test-results');\n            if (testResults.length === 0) {\n                resultsDiv.innerHTML = '<div class=\"status info\">No tests run yet. Use the controls above to test the popup system.</div>';\n                return;\n            }\n            \n            resultsDiv.innerHTML = testResults.slice(-20).map(result => \n                `<div class=\"result-item\">\n                    <span class=\"timestamp\">[${result.timestamp}]</span>\n                    <span class=\"status ${result.type}\" style=\"display: inline; padding: 2px 6px; margin-left: 8px;\">${result.message}</span>\n                </div>`\n            ).join('');\n            \n            // Auto-scroll to bottom\n            resultsDiv.scrollTop = resultsDiv.scrollHeight;\n        }\n        \n        function clearTestResults() {\n            testResults = [];\n            updateTestResults();\n        }\n        \n        function exportTestResults() {\n            const data = testResults.map(r => `[${r.timestamp}] ${r.type.toUpperCase()}: ${r.message}`).join('\\n');\n            const blob = new Blob([data], { type: 'text/plain' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `popup-test-results-${new Date().toISOString().slice(0, 19)}.txt`;\n            a.click();\n            URL.revokeObjectURL(url);\n        }\n        \n        // Festival popup functions\n        function showFestivalPopup() {\n            if (window.festivalPopupHandler) {\n                window.festivalPopupHandler.popupShown = false;\n                window.festivalPopupHandler.showPopup();\n                addTestResult('✅ Festival popup triggered manually', 'success');\n            } else {\n                addTestResult('❌ Festival popup handler not loaded', 'error');\n            }\n        }\n        \n        function clearFestivalStorage() {\n            sessionStorage.removeItem('festival_popup_shown');\n            localStorage.removeItem('festival_popup_last_shown');\n            addTestResult('🗑️ Festival popup storage cleared', 'info');\n        }\n        \n        function testFestivalError() {\n            // Simulate API error for festival popup\n            addTestResult('🧪 Testing festival popup error handling...', 'info');\n            // This would normally trigger error handling in the popup\n        }\n        \n        // Blog popup functions\n        function showBlogPopup() {\n            if (window.blogPopupHandler) {\n                window.blogPopupHandler.popupShown = false;\n                window.blogPopupHandler.showPopup();\n                addTestResult('✅ Blog popup triggered manually', 'success');\n            } else {\n                addTestResult('❌ Blog popup handler not loaded', 'error');\n            }\n        }\n        \n        function clearBlogStorage() {\n            sessionStorage.removeItem('blog_popup_shown');\n            localStorage.removeItem('blog_popup_last_shown');\n            addTestResult('🗑️ Blog popup storage cleared', 'info');\n        }\n        \n        function testBlogError() {\n            // Simulate API error for blog popup\n            addTestResult('🧪 Testing blog popup error handling...', 'info');\n        }\n        \n        // Advanced test functions\n        function testSequentialPopups() {\n            addTestResult('🧪 Testing sequential popups...', 'info');\n            clearAllStorage();\n            \n            // Show festival popup first\n            setTimeout(() => {\n                showFestivalPopup();\n                addTestResult('1️⃣ Festival popup shown first', 'info');\n                \n                // Show blog popup 3 seconds later\n                setTimeout(() => {\n                    showBlogPopup();\n                    addTestResult('2️⃣ Blog popup shown second', 'info');\n                }, 3000);\n            }, 1000);\n        }\n        \n        function testSimultaneousPopups() {\n            addTestResult('🧪 Testing simultaneous popups (not recommended)...', 'warning');\n            clearAllStorage();\n            \n            setTimeout(() => {\n                showFestivalPopup();\n                showBlogPopup();\n                addTestResult('⚠️ Both popups triggered simultaneously', 'warning');\n            }, 1000);\n        }\n        \n        function testDelayedPopups() {\n            addTestResult('🧪 Testing popups with different delays...', 'info');\n            clearAllStorage();\n            \n            // Festival popup with 2 second delay\n            if (window.festivalPopupHandler) {\n                window.festivalPopupHandler.settings.delay = 2000;\n                window.festivalPopupHandler.popupShown = false;\n                window.festivalPopupHandler.setupPopupDisplay();\n            }\n            \n            // Blog popup with 5 second delay\n            if (window.blogPopupHandler) {\n                window.blogPopupHandler.settings.delay = 5000;\n                window.blogPopupHandler.popupShown = false;\n                window.blogPopupHandler.setupPopupDisplay();\n            }\n            \n            addTestResult('⏱️ Festival popup: 2s delay, Blog popup: 5s delay', 'info');\n        }\n        \n        function testFrequencySettings(frequency) {\n            addTestResult(`🧪 Testing frequency setting: ${frequency}`, 'info');\n            \n            if (window.festivalPopupHandler) {\n                window.festivalPopupHandler.settings.frequency = frequency;\n            }\n            if (window.blogPopupHandler) {\n                window.blogPopupHandler.settings.frequency = frequency;\n            }\n            \n            clearAllStorage();\n            \n            const festivalShouldShow = window.festivalPopupHandler?.checkDisplayFrequency();\n            const blogShouldShow = window.blogPopupHandler?.checkDisplayFrequency();\n            \n            addTestResult(`Festival should show: ${festivalShouldShow}, Blog should show: ${blogShouldShow}`, 'info');\n        }\n        \n        function clearAllStorage() {\n            clearFestivalStorage();\n            clearBlogStorage();\n            addTestResult('🗑️ All popup storage cleared', 'info');\n        }\n        \n        function showStorageStatus() {\n            const festivalSession = sessionStorage.getItem('festival_popup_shown');\n            const festivalLocal = localStorage.getItem('festival_popup_last_shown');\n            const blogSession = sessionStorage.getItem('blog_popup_shown');\n            const blogLocal = localStorage.getItem('blog_popup_last_shown');\n            \n            addTestResult(`Storage Status:`, 'info');\n            addTestResult(`Festival - Session: ${festivalSession || 'none'}, Local: ${festivalLocal || 'none'}`, 'info');\n            addTestResult(`Blog - Session: ${blogSession || 'none'}, Local: ${blogLocal || 'none'}`, 'info');\n        }\n        \n        function simulateReturningUser() {\n            // Set storage to simulate a returning user\n            sessionStorage.setItem('festival_popup_shown', 'true');\n            sessionStorage.setItem('blog_popup_shown', 'true');\n            localStorage.setItem('festival_popup_last_shown', new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString()); // 12 hours ago\n            localStorage.setItem('blog_popup_last_shown', new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString()); // 6 hours ago\n            \n            addTestResult('👤 Simulated returning user with existing popup history', 'info');\n        }\n        \n        // API test functions\n        async function testFestivalAPI() {\n            try {\n                addTestResult('🧪 Testing Festival API...', 'info');\n                const response = await fetch('https://web-production-18602.up.railway.app/api/festivals/test-store.myshopify.com', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    const data = await response.json();\n                    addTestResult(`✅ Festival API: ${data.festivals?.length || 0} festivals loaded`, 'success');\n                } else {\n                    addTestResult(`❌ Festival API error: ${response.status}`, 'error');\n                }\n            } catch (error) {\n                addTestResult(`❌ Festival API error: ${error.message}`, 'error');\n            }\n        }\n        \n        async function testBlogAPI() {\n            try {\n                addTestResult('🧪 Testing Blog API...', 'info');\n                const response = await fetch('https://web-production-18602.up.railway.app/api/blog-popup/test-store.myshopify.com', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    const data = await response.json();\n                    addTestResult(`✅ Blog API: Settings loaded (enabled: ${data.blogPopupSettings?.enabled})`, 'success');\n                } else {\n                    addTestResult(`❌ Blog API error: ${response.status}`, 'error');\n                }\n            } catch (error) {\n                addTestResult(`❌ Blog API error: ${error.message}`, 'error');\n            }\n        }\n        \n        async function testSubscriptionAPI() {\n            try {\n                addTestResult('🧪 Testing Subscription API...', 'info');\n                \n                // Test festival subscription\n                const festivalResponse = await fetch('https://web-production-18602.up.railway.app/api/newsletter/subscribe', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'ngrok-skip-browser-warning': 'true'\n                    },\n                    body: JSON.stringify({\n                        email: 'test@example.com',\n                        shopDomain: 'test-store.myshopify.com',\n                        subscriptionType: 'festival'\n                    })\n                });\n                \n                if (festivalResponse.ok) {\n                    addTestResult('✅ Festival subscription API working', 'success');\n                } else {\n                    addTestResult(`❌ Festival subscription API error: ${festivalResponse.status}`, 'error');\n                }\n                \n                // Test blog subscription\n                const blogResponse = await fetch('https://web-production-18602.up.railway.app/api/newsletter/subscribe', {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'ngrok-skip-browser-warning': 'true'\n                    },\n                    body: JSON.stringify({\n                        email: 'test-blog@example.com',\n                        shopDomain: 'test-store.myshopify.com',\n                        subscriptionType: 'blog'\n                    })\n                });\n                \n                if (blogResponse.ok) {\n                    addTestResult('✅ Blog subscription API working', 'success');\n                } else {\n                    addTestResult(`❌ Blog subscription API error: ${blogResponse.status}`, 'error');\n                }\n                \n            } catch (error) {\n                addTestResult(`❌ Subscription API error: ${error.message}`, 'error');\n            }\n        }\n        \n        // Settings loading functions\n        async function loadFestivalSettings() {\n            try {\n                const response = await fetch('https://web-production-18602.up.railway.app/api/festivals/test-store.myshopify.com', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    const data = await response.json();\n                    const activeFestivals = data.festivals?.filter(f => f.isActive) || [];\n                    \n                    document.getElementById('festival-settings').innerHTML = `\n                        <div class=\"settings-grid\">\n                            <div class=\"setting-item\">\n                                <span class=\"setting-label\">Active Festivals:</span>\n                                <span class=\"setting-value\">${activeFestivals.length}</span>\n                            </div>\n                            <div class=\"setting-item\">\n                                <span class=\"setting-label\">Popup Enabled:</span>\n                                <span class=\"setting-value\">${data.isActive ? '✅' : '❌'}</span>\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    document.getElementById('festival-settings').innerHTML = '<div class=\"status error\">Failed to load festival settings</div>';\n                }\n            } catch (error) {\n                document.getElementById('festival-settings').innerHTML = '<div class=\"status error\">Error: ' + error.message + '</div>';\n            }\n        }\n        \n        async function loadBlogSettings() {\n            try {\n                const response = await fetch('https://web-production-18602.up.railway.app/api/blog-popup/test-store.myshopify.com', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    const data = await response.json();\n                    const settings = data.blogPopupSettings;\n                    \n                    if (settings) {\n                        document.getElementById('blog-settings').innerHTML = `\n                            <div class=\"settings-grid\">\n                                <div class=\"setting-item\">\n                                    <span class=\"setting-label\">Enabled:</span>\n                                    <span class=\"setting-value\">${settings.enabled ? '✅' : '❌'}</span>\n                                </div>\n                                <div class=\"setting-item\">\n                                    <span class=\"setting-label\">Title:</span>\n                                    <span class=\"setting-value\">${settings.title}</span>\n                                </div>\n                                <div class=\"setting-item\">\n                                    <span class=\"setting-label\">Delay:</span>\n                                    <span class=\"setting-value\">${settings.delay}ms</span>\n                                </div>\n                                <div class=\"setting-item\">\n                                    <span class=\"setting-label\">Frequency:</span>\n                                    <span class=\"setting-value\">${settings.frequency}</span>\n                                </div>\n                                <div class=\"setting-item\">\n                                    <span class=\"setting-label\">Background:</span>\n                                    <span class=\"setting-value\">\n                                        <span class=\"color-swatch\" style=\"background: ${settings.backgroundColor};\"></span>\n                                        ${settings.backgroundColor}\n                                    </span>\n                                </div>\n                            </div>\n                        `;\n                    } else {\n                        document.getElementById('blog-settings').innerHTML = '<div class=\"status warning\">No blog settings found</div>';\n                    }\n                } else {\n                    document.getElementById('blog-settings').innerHTML = '<div class=\"status error\">Failed to load blog settings</div>';\n                }\n            } catch (error) {\n                document.getElementById('blog-settings').innerHTML = '<div class=\"status error\">Error: ' + error.message + '</div>';\n            }\n        }\n        \n        async function checkAPIStatus() {\n            const statusDiv = document.getElementById('api-status');\n            try {\n                const response = await fetch('https://web-production-18602.up.railway.app/health', {\n                    headers: { 'ngrok-skip-browser-warning': 'true' }\n                });\n                \n                if (response.ok) {\n                    statusDiv.textContent = '✅ API Connected';\n                    statusDiv.className = 'api-status status success';\n                } else {\n                    statusDiv.textContent = '⚠️ API Issues';\n                    statusDiv.className = 'api-status status error';\n                }\n            } catch (error) {\n                statusDiv.textContent = '❌ API Offline';\n                statusDiv.className = 'api-status status error';\n            }\n        }\n        \n        function updateSystemStatus() {\n            const statusDiv = document.getElementById('system-status');\n            const festivalLoaded = !!window.festivalPopupHandler;\n            const blogLoaded = !!window.blogPopupHandler;\n            \n            statusDiv.innerHTML = `\n                <div class=\"settings-grid\">\n                    <div class=\"setting-item\">\n                        <span class=\"setting-label\">Festival Handler:</span>\n                        <span class=\"setting-value\">${festivalLoaded ? '✅ Loaded' : '❌ Not Loaded'}</span>\n                    </div>\n                    <div class=\"setting-item\">\n                        <span class=\"setting-label\">Blog Handler:</span>\n                        <span class=\"setting-value\">${blogLoaded ? '✅ Loaded' : '❌ Not Loaded'}</span>\n                    </div>\n                    <div class=\"setting-item\">\n                        <span class=\"setting-label\">Shopify Object:</span>\n                        <span class=\"setting-value\">${window.Shopify ? '✅ Available' : '❌ Missing'}</span>\n                    </div>\n                    <div class=\"setting-item\">\n                        <span class=\"setting-label\">Test Environment:</span>\n                        <span class=\"setting-value\">✅ Active</span>\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Initialize page\n        document.addEventListener('DOMContentLoaded', function() {\n            checkAPIStatus();\n            loadFestivalSettings();\n            loadBlogSettings();\n            updateSystemStatus();\n            \n            addTestResult('🚀 Dual popup test page initialized', 'success');\n            \n            // Check for handlers periodically\n            const checkHandlers = setInterval(() => {\n                updateSystemStatus();\n                \n                if (window.festivalPopupHandler && !window.festivalHandlerLogged) {\n                    addTestResult('✅ Festival popup handler loaded', 'success');\n                    window.festivalHandlerLogged = true;\n                }\n                \n                if (window.blogPopupHandler && !window.blogHandlerLogged) {\n                    addTestResult('✅ Blog popup handler loaded', 'success');\n                    window.blogHandlerLogged = true;\n                }\n                \n                if (window.festivalPopupHandler && window.blogPopupHandler) {\n                    clearInterval(checkHandlers);\n                    addTestResult('🎉 Both popup handlers loaded successfully', 'success');\n                }\n            }, 1000);\n            \n            // Timeout after 15 seconds\n            setTimeout(() => {\n                clearInterval(checkHandlers);\n                if (!window.festivalPopupHandler || !window.blogPopupHandler) {\n                    addTestResult('⚠️ Some popup handlers failed to load within 15 seconds', 'warning');\n                }\n            }, 15000);\n        });\n    </script>\n    \n    <!-- Load popup handlers -->\n    <script src=\"/festival-newsletter-popup/extensions/newsletter-popup/assets/popup-handler.js\"></script>\n    <script src=\"/festival-newsletter-popup/extensions/newsletter-popup/assets/blog-popup-handler.js\"></script>\n</body>\n</html>"